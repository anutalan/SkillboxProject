---
## 13. Базовая архитектура 

*Базовая архитектура с учётом ограничений бизнес-требований, НФТ, выбранной архитектуры, адресация атрибутов качества.*

Ограничения: MVP в рамках одного облака, страны.

### *1. Компоненты*
1. Приложения

1.1 Мобильное приложение для клиентов

- iOS;

- Android;

1.2 Web приложение для клиентов

- MS Edge;
- Chrome;
- Yandex;

1.3 Web приложение для администрирования платформы

2. BFF 

2.1 Rest Api для Web клиента;

2.2 Rest Api для мобилок;

2.3 Rest Api для Web админа;

3. Бизнесовые микросервисы платформы

3.1 Пользователей  - управление учетками пользователей, их профилями;

3.2 Тренировок - хранение тренировок пользователей, сравнительный анализ своих тренировок;

3.3 Социальной сети - возможность добавлять друзей, общаться с другими пользователями;

3.4 Геймификации - управление баллами, наградами за достижения, которые простимулируют пользователей на активности на платформе;

3.5 Новостей и Рекламы - управление новостной лентой, статьями, рекламными акциями бренда - используются настройки видимости, интересы, предоставленные пользователем;

3.6 Устройств-датчиков  - управление настройкой интеграционных каналов с Google Fit, Apple HealthKit, которые могут передать данные о тренировках пользователя (шаги, пульс, расстояние, активность);

3.7 Онлайн площадок бренда  - интеграция с приоритетными магазинами по переходу в них по клику на рекламу бренда в рамках одной страны;

3.8  Нотификации - минимальный функционала отправки уведомлений пользователям для авторизации в системе по смс, почтой - используются настройки и данные, предоставленные пользователем;

4. Сервисные микросервисы платформы

4.1 Авторизации и аутентификации (Idp) - обеспечение проверки пользователей и предоставлене им прав на платформе, нагрузка до 100 000 пользователей;

4.2 Gateways - маршрутизация запросов для безопасности между слоями платформы;

4.3 Registries  - сервис для корректного подключения микросервисов в сети;

4.4 Broker Kafka - для надежной интеграции между сервисами данными;

4.5 Prometheus  - мониториг платформы - на начальном этапе достаточно встроенного дашборда.


### *2. Верхеуровневая схема*

Верхнеуровнево приведено взаимодействие компонент

```mermaid
  graph TD;
  subgraph "Клиентская зона"
        Web[Клиентское Web приложение]
        Mobile[Клиентское мобильное приложение]
        AdminWeb[Web приложение поддержки]
        Платформа_IoT
        Онлайн_площадки_бренда
  end
    
  subgraph "Демилитаризованная зона"
        Client_API_Gateway
        BFF
        Auth
        Store_GateWay
        IoT_GateWay
  end
  
  subgraph "Внутренняя сеть"
        Platform_API_Gateway
        Сервис_Пользователей
        Сервис_Тренировок
        Сервис_Новостей_Рекламы
        Сервис_Устройств-датчиков
        Сервис_Онлайн_площадок_бренда
        Сервис_Уведомлений
        Сервис_Социальной_сети
        Сервис_Геймификации
        Prometheus        
  end
  
  
  Web -->Client_API_Gateway;
  Mobile -->Client_API_Gateway;
  AdminWeb -->Client_API_Gateway;
  Client_API_Gateway-->BFF;
  Client_API_Gateway-->Auth;
  BFF-->Platform_API_Gateway;
  Platform_API_Gateway-->Сервис_Пользователей;
  Platform_API_Gateway-->Сервис_Тренировок;
  Platform_API_Gateway-->Сервис_Социальной_сети;
  Platform_API_Gateway-->Сервис_Геймификации;
  Platform_API_Gateway-->Сервис_Новостей_Рекламы;
  Platform_API_Gateway-->Сервис_Уведомлений;
  Platform_API_Gateway-->Сервис_Устройств-датчиков;
  Platform_API_Gateway-->Сервис_Онлайн_площадок_бренда;
  
  Сервис_Тренировок-->Prometheus;
  Сервис_Новостей_Рекламы-->Prometheus;
  Сервис_Онлайн_площадок_бренда-->Prometheus;
  Сервис_Устройств-датчиков-->Prometheus;
  BFF-->Prometheus;
  Сервис_Социальной_сети-->Prometheus
  Сервис_Геймификации-->Prometheus
  Auth-->Prometheus
  
  Онлайн_площадки_бренда-->Store_GateWay;
  Store_GateWay-->Сервис_Онлайн_площадок_бренда;
  Платформа_IoT-->IoT_GateWay;
  IoT_GateWay--> Сервис_Устройств-датчиков;
  Сервис_Уведомлений-->Сервис_Пользователей;  
  Сервис_Новостей_Рекламы-->Сервис_Пользователей;  
  
   style Prometheus fill:#e1f8fe
   style Auth fill:#fff3e0
   style Client_API_Gateway fill:#f3e8f5
   style Platform_API_Gateway fill:#f3e8f5
   style Web fill:#fff990
   style Mobile fill:#fff990
   style AdminWeb fill:#fff990   

 ```
```
