---
## 4. Концептуальная архитектура
### *1. Компоненты*

1. Приложения

1.1 Мобильное приложение для клиентов

- iOS;

- Android;

1.2 Web приложение для клиентов

- MS Edge;
- Chrome;
- Yandex;

1.3 Web приложение для администрирования платформы

2. BFF 

2.1 Rest Api для Web клиента;

2.2 Rest Api для мобилок;

2.3 Rest Api для Web админа;

3. Бизнесовые микросервисы платформы

3.1 Пользователей  - управление учетками пользователей, их профилями;

3.2 Тренировок - хранение тренировок пользователей;

3.3 Социальной сети - управление группами, чатами, лентой активностей , друзьями;

3.4 Геймификации - управление соревнованиями, рейтингом, баллами, стимулирующих пользователей на активности на платформе;

3.5 Новостей и Рекламы - управление новостной лентой, статьями, рекламными акциями бренда, рекомендациями для использования инвентаря в разных видов спорта, мероприятиях;

3.6 Устройств-датчиков  - управление настройкой интеграционных каналов с разными спортивными устройствами, которые могут передать данные о тренировках пользователя;

3.7 Онлайн площадок бренда  - управление настройкой интеграционных каналов с существующими магазинами бренда в разных странах;

3.8  Нотификации - управление шаблонами уведомлений пользователей по смс, почтой, push сообщеними;

3.9 Календаря тренировок - составление плана тренировок для пользователя, управление публикаций активностей групп, соревнований, запланированных пользователем тренировок; 

4. Сервисные микросервисы платформы

4.1 Авторизации и аутентификации (Idp) - обеспечение проверки пользователей и предоставлене им прав на платформе;

4.2 Gateways - маршрутизация запросов для безопасности между слоями платформы;

4.3 Registries  - сервис для корректного подключения микросервисов в сети;

4.4 Broker Kafka - для надежной интеграции между сервисами данными;

4.5 Prometheus  - мониториг платформы;

4.6 Grafana  - Ui с дашбордами для просмотра метрик платформы.

4.7 DWH (Liquibase) + BI + ML  - сбор и аналитика данных;

### *2. Верхеуровневая схема*

```mermaid
  graph TD;
  subgraph "Клиентская зона"
        Web[Клиентское Web приложение]
        Mobile[Клиентское мобильное приложение]
        AdminWeb[Web приложение поддержки]
        Платформа_IoT
        Онлайн_площадки_бренда       
  end
  subgraph "Демилитаризованная зона"
        Client_API_Gateway
        Web_BFF
        Mobile_BFF
        AdminWeb_BFF
        Auth
        Store_GateWay
        IoT_GateWay
  end
  subgraph "Внутренняя сеть"
    subgraph "Мониторинг"
        Prometheus
        PODS_Moниторинг
        Grafana
        Prometheus_Alerting
    end
        Platform_API_Gateway
        Сервис_Пользователей
        Сервис_Тренировок
        Сервис_Календаря_тренировок
        Сервис_Новостей_Рекламы
        Сервис_Устройств-датчиков
        Сервис_Онлайн_площадок_бренда
        Сервис_Уведомлений
        Сервис_Социальной_сети
        Сервис_Геймификации
        Prometheus       
        Кэш[(Кэш HazelCast)]
        BackToBackAuth      
   
    subgraph " BI "
       BI
       ML
       ВитринаML[(Витрина ML)]
       ВитринаBI[(Витрина BI)]
       Storage_Liquibase[(Storage Liquibase)]
    end   
   end
  
  Platform_API_Gateway-->Кэш
  Platform_API_Gateway-->BackToBackAuth
  Web -->Client_API_Gateway;
  Mobile -->Client_API_Gateway;
  AdminWeb -->Client_API_Gateway;
  Client_API_Gateway-->Web_BFF;
  Client_API_Gateway-->Mobile_BFF;
  Client_API_Gateway-->AdminWeb_BFF;
  Client_API_Gateway-->Auth;
  Web_BFF-->Platform_API_Gateway;
  Mobile_BFF-->Platform_API_Gateway;
  AdminWeb_BFF-->Platform_API_Gateway;
  
  
  Платформа_IoT-->IoT_GateWay;
  IoT_GateWay-->Сервис_Устройств-датчиков;
  Онлайн_площадки_бренда-->Store_GateWay;
  Store_GateWay-->Сервис_Онлайн_площадок_бренда;
  Сервис_Уведомлений-->Сервис_Пользователей;  
  Сервис_Новостей_Рекламы-->Сервис_Пользователей;  
  
 
  Platform_API_Gateway-->Сервис_Тренировок;
  Platform_API_Gateway-->Сервис_Календаря_тренировок;
  Platform_API_Gateway-->Сервис_Социальной_сети;
  Platform_API_Gateway-->Сервис_Геймификации;
  Platform_API_Gateway-->Сервис_Новостей_Рекламы;
  Platform_API_Gateway-->Сервис_Пользователей;
  Platform_API_Gateway-->Сервис_Уведомлений;
  Platform_API_Gateway-->Сервис_Устройств-датчиков;
  Platform_API_Gateway-->Сервис_Онлайн_площадок_бренда;
   
 
   Prometheus-->PODS_Moниторинг;
   Prometheus-->Grafana; 
   Prometheus-->Prometheus_Alerting; 
   
   
  ML-->ВитринаML; 
  BI-->ВитринаBI; 
  ВитринаML-->Storage_Liquibase; 
  ВитринаBI-->Storage_Liquibase; 
  
   
   style Grafana fill:#e1f8fe
   style Prometheus_Alerting fill:#e1f8fe
   style Prometheus fill:#e1f8fe
   style PODS_Moниторинг fill:#e1f8fe
   
   style Auth fill:#F0E68C
   style BackToBackAuth fill:#F0E68C
   
   style IoT_GateWay fill:#D8BFD8
   style Store_GateWay fill:#D8BFD8
   style Client_API_Gateway fill:#D8BFD8
   style Platform_API_Gateway fill:#D8BFD8
   
   style Web fill:#fff990
   style Mobile fill:#fff990
   style AdminWeb fill:#fff990   
  


 ```
