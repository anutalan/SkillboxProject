## 14.1,3 Функциональное + Многозадачное представления 
### *1. Пользовательский профиль* 

```mermaid
  graph TD;
  
  subgraph "Внутренняя сеть"
        Platform_API_Gateway
        Сервис_Пользователей
        БДПользователей[(БД Пользоватей)]
        Брокер_Kafka
    end
  
   Platform_API_Gateway--> |1.1 Rest Создать <br> пользователя| Сервис_Пользователей; Platform_API_Gateway--> |2.1 Rest Изменить <br> пользователя| Сервис_Пользователей;
  Platform_API_Gateway--> |3.1 Rest Получить <br> пользователя| Сервис_Пользователей;
   Platform_API_Gateway--> |4.1 Rest Создать настройки <br> пользователя| Сервис_Пользователей; Platform_API_Gateway--> |5.1 Rest Изменить настройки <br> пользователя| Сервис_Пользователей;
  Platform_API_Gateway--> |6.1 Rest Получитьнастройки <br> пользователя| Сервис_Пользователей;
  Сервис_Пользователей--> |2.1 Создать пользователя<br>2.2 Изменить пользователя<br>3.2 Получить пользователя<br>4.2 Создать настройки пользователя<br>5.2 Изменить настройки пользователя<br> 6.2 Получить настройки пользователя<br>| БДПользователей; 
  Сервис_Пользователей--> |2.3\4.3\5.3 Публикация <br>Событие_пользователя| Брокер_Kafka; 
  
   style Platform_API_Gateway fill:#D8BFD8
   style Брокер_Kafka fill:#AFEEEE


 ```
### *2. Социальные сети* 

```mermaid
  graph TD;
  
  subgraph "Внутренняя сеть"
        Platform_API_Gateway
        Сервис_Социальной_сети
        БДСоциальной_сети
        Брокер_Kafka
    end

  Platform_API_Gateway--> |1.1 Rest Создать подписку <br> пользователем| Сервис_Социальной_сети; 
  Platform_API_Gateway--> |2.1 Rest Изменить статус <br> подписки  пользователя| Сервис_Социальной_сети;
  Platform_API_Gateway--> |3.1 Rest Получить подписки <br> пользователя|Сервис_Социальной_сети;
  Сервис_Социальной_сети-->|1.2 Сохранить подписку<br>2.2 Изменить подписку<br> 3.2 Получить подписки<br>| БДСоциальной_сети[(БД Устройств)] 
  Сервис_Социальной_сети--> |1.3\2.3 Публикация <br>Событие_пользователя| Брокер_Kafka; 
   
   style Platform_API_Gateway fill:#D8BFD8
   style Брокер_Kafka fill:#AFEEEE


 ```
### *3. Тренировки* 

```mermaid
  graph TD;
    
  subgraph "Демилитаризованная зона"
        IoT_GateWay
  end
  
  subgraph "Внутренняя сеть"
        Platform_API_Gateway
        Сервис_Тренировок
        Сервис_Устройств-датчиков
        Брокер_Kafka
        БДУстройств
        БДТренировок
    end

IoT_GateWay--> |4.3\5.3 Публикация <br>Сообщения Телеметрия пользователя| Брокер_Kafka;
Сервис_Устройств-датчиков--> |5.2.2 Rest Изменить статус  <br> телеметрии пользователя|IoT_GateWay;  Сервис_Устройств-датчиков--> |4.2.2 Rest Создать телеметрию <br> пользователя|IoT_GateWay;
Сервис_Устройств-датчиков-->|Подписка <br>Сообщение Телеметрия пользователя| Брокер_Kafka;
Platform_API_Gateway-->Сервис_Устройств-датчиков;
Сервис_Тренировок--> |1.3\2.3 Публикация <br>Событие_пользователя| Брокер_Kafka;

Platform_API_Gateway--> |6.1 Rest Получить телеметрию <br> пользователя| Сервис_Устройств-датчиков; Platform_API_Gateway--> |5.1 Rest Изменить статус <br> телеметрии пользователя| Сервис_Устройств-датчиков;  
Platform_API_Gateway--> |4.1 Rest Создать телеметрию <br> пользователем| Сервис_Устройств-датчиков;
Platform_API_Gateway--> |3.1 Rest Получить тренировки <br> пользователя| Сервис_Тренировок; Platform_API_Gateway--> |2.1 Rest Изменить тренировку <br> пользователя| Сервис_Тренировок;  
Platform_API_Gateway--> |1.1 Rest Создать тренировку <br> пользователем| Сервис_Тренировок; 
  
  Сервис_Устройств-датчиков-->|4.2.1 Сохранить запрос на телеметрию<br>4.4 Создать телеметрию<br>5.2.1 Сохранить запрос на изменение телеметрии<br> 5.4 Изменить телеметрию<br> 6.2 Получить телеметрию| БДУстройств[(БД Устройств)]
  Сервис_Тренировок-->|1.2 Создать тренировку<br>2.2 Изменить тренировку<br> 3.2 Получить тренировку|БДТренировок[(БД Тренировок)]


   style IoT_GateWay fill:#D8BFD8
   style Platform_API_Gateway fill:#D8BFD8
   style Брокер_Kafka fill:#AFEEEE


 ```
 
 ### *4. Онлайн площадки бренда* 
```mermaid
  graph TD;
    
  subgraph "Демилитаризованная зона"
        Store_GateWay
  end
  
  subgraph "Внутренняя сеть"
        Platform_API_Gateway
        Сервис_Онлайн_площадок_бренда
        Брокер_Kafka
        БДОнлайн_площадок[(БД Площадок)]
   end

Store_GateWay--> |4.1\5.1 Публикация <br>Сообщения Заказ пользователя| Брокер_Kafka;
Сервис_Онлайн_площадок_бренда-->|Подписка <br> Сообщение Заказ пользователя| Брокер_Kafka;
Сервис_Онлайн_площадок_бренда--> |1.3\2.3 Публикация <br>Сообщения Онлайн площадка| Брокер_Kafka;
Store_GateWay-->|Подписка <br> Сообщение Онлайн площадка| Брокер_Kafka;


Platform_API_Gateway--> |6.1 Rest Получить заказы <br> пользователя| Сервис_Онлайн_площадок_бренда;
Platform_API_Gateway--> |3.1 Rest Получить онлайн площадку| Сервис_Онлайн_площадок_бренда; 
Platform_API_Gateway--> |2.1 Rest Изменить онлайн площадку| Сервис_Онлайн_площадок_бренда;
Platform_API_Gateway--> |1.1 Rest Создать онлайн площадку| Сервис_Онлайн_площадок_бренда;

  
  Сервис_Онлайн_площадок_бренда-->|1.2 Создать онлайн площадку<br>2.2 Изменить онлайн площадку<br>3.2 Получить онлайн площадку<br>4.2 Создать заказ<br>5.2 Изменить заказ<br>6.2 Получить заказы пользователя<br>| БДОнлайн_площадок


   style Store_GateWay fill:#D8BFD8
   style Platform_API_Gateway fill:#D8BFD8
   style Брокер_Kafka fill:#AFEEEE


 ```
  ### *5. Геймификация* 
 ```mermaid
  graph TD;
  
  subgraph "Внутренняя сеть"
        Platform_API_Gateway
        Сервис_Геймификации
        Сервис_Тренировок
        Сервис_Пользователей
        Сервис_Социальной_сети
        БДГеймификации[(БД Геймификации)]
        Брокер_Kafka
    end

  Platform_API_Gateway--> |2.1 Rest Получить баланс пользователя <br> пользователем| Сервис_Геймификации; 

  Сервис_Геймификации-->|1.2 Зачислить\ Списать баллы за событие пользователя<br>2.2 Получить подписки<br>| БДГеймификации 
  Сервис_Геймификации-->|1.3 Публикация <br>Событие_пользователя|Брокер_Kafka
  Сервис_Геймификации-->|Подписка <br> Сообщение Событие_пользователя|Брокер_Kafka
  Сервис_Тренировок--> |1.1.1 Публикация <br>Событие_пользователя| Брокер_Kafka;
  Сервис_Пользователей--> |1.1.2 Публикация <br>Событие_пользователя| Брокер_Kafka;
  Сервис_Социальной_сети--> |1.1.3 Публикация <br>Событие_пользователя| Брокер_Kafka;
   
   style Platform_API_Gateway fill:#D8BFD8 
   style Брокер_Kafka fill:#AFEEEE

```  

  ### *6. Новости и реклама бренда* 
 ```mermaid
  graph TD;
  
  subgraph "Внутренняя сеть"
        Platform_API_Gateway
        Сервис_Новостей_Рекламы
        Сервис_Геймификации
        Сервис_Тренировок
        Сервис_Пользователей
        Сервис_Социальной_сети
        БДСоциальной_сети[(БД Соц_сети)]
        Брокер_Kafka
    end

  Platform_API_Gateway--> |2.1 Rest Создать новость| Сервис_Новостей_Рекламы; 
  Platform_API_Gateway--> |3.1 Rest Изменить новость| Сервис_Новостей_Рекламы; 
  Platform_API_Gateway--> |4.1 Rest Получить <br>новости пользователя| Сервис_Новостей_Рекламы; 

  Сервис_Новостей_Рекламы-->|4.2 Получить <br> настройки пользователя| Сервис_Пользователей 

  Сервис_Новостей_Рекламы-->|1.2\2.2 Создать новость<br>3.2 Изменить новость<br>4.3 Получить новости<br>| БДСоциальной_сети 
  Сервис_Новостей_Рекламы-->|Подписка Сообщение <br>Событие_пользователя|Брокер_Kafka
  Сервис_Тренировок--> |1.1.1 Публикация <br>Событие_пользователя| Брокер_Kafka;
  Сервис_Пользователей--> |1.1.2 Публикация <br>Событие_пользователя| Брокер_Kafka;
  Сервис_Социальной_сети--> |1.1.3 Публикация <br>Событие_пользователя| Брокер_Kafka;
  Сервис_Геймификации--> |1.1.4 Публикация <br>Событие_пользователя| Брокер_Kafka;
   
   style Platform_API_Gateway fill:#D8BFD8 
   style Брокер_Kafka fill:#AFEEEE

```  
  ### *7. Уведомления пользователя* 
 ```mermaid
  graph TD;
  
  subgraph "Внутренняя сеть"
        Platform_API_Gateway
        Сервис_Уведомлений
        Сервис_Геймификации
        Сервис_Тренировок
        Сервис_Пользователей
        Сервис_Социальной_сети
        БДУведомлений[(БД Уведомлений)]
        Брокер_Kafka
    end

  Platform_API_Gateway--> |2.1 Rest Создать уведомление| Сервис_Уведомлений; 
  Platform_API_Gateway--> |3.1 Rest Изменить уведомление| Сервис_Уведомлений; 
  Platform_API_Gateway--> |4.1 Rest Получить уведомление| Сервис_Уведомлений; 

  Сервис_Уведомлений-->|1.2\2.2\3.2 Получить <br> настройки пользователя| Сервис_Пользователей; 

  Сервис_Уведомлений-->|1.3\2.3 Создать уведомление<br>3.3 Изменить уведомление<br>4.3 Получить уведомления<br>| БДУведомлений; 
   
  Сервис_Уведомлений--> |Подписка Сообщение <br>Событие_пользователя| Брокер_Kafka;
  Сервис_Тренировок--> |1.1.1 Публикация <br>Событие_пользователя| Брокер_Kafka;
  Сервис_Пользователей--> |1.1.2 Публикация <br>Событие_пользователя| Брокер_Kafka;
  Сервис_Социальной_сети--> |1.1.3 Публикация <br>Событие_пользователя| Брокер_Kafka;
  Сервис_Геймификации--> |1.1.4 Публикация <br>Событие_пользователя| Брокер_Kafka;
   
   style Platform_API_Gateway fill:#D8BFD8 
   style Брокер_Kafka fill:#AFEEEE

```  

  ### *8. ML и BI* 
 ```mermaid
  graph TD;
  
  subgraph "Внутренняя сеть"
       BI
       ML
       ВитринаML[(Витрина ML)]
       ВитринаBI[(Витрина BI)]
       Storage_Liquibase[(Storage Liquibase)]
       Брокер_Kafka
    subgraph "Кластер БД"
        БДПользователей[(БД Пользоватей)]
        БДТренировок[(БД Тренировок)]
        БДНовостей[(БД Новостей)]
        БДУстройств[(БД Устройств)]
        БДОнлайн_площадок[(БД Площадок)]
        БДСоциальной_сети[(БД Соц_сети)]
        БДУведомлений[(БД Уведомлений)]
        БДГеймификации[(БД Геймификации)]
     end
    end

  ML-->ВитринаML; 
  ML-->|Публикация <br>Событие_пользователя notMVP|Брокер_Kafka;
  BI-->ВитринаBI; 
  ВитринаML-->Storage_Liquibase; 
  ВитринаBI-->Storage_Liquibase; 
  Storage_Liquibase--> БДПользователей; 
  Storage_Liquibase--> БДТренировок;
  Storage_Liquibase--> БДНовостей;
  Storage_Liquibase--> БДУстройств;
  Storage_Liquibase--> БДОнлайн_площадок;
  Storage_Liquibase--> БДСоциальной_сети; 
  Storage_Liquibase--> БДУведомлений;
  Storage_Liquibase--> БДГеймификации;
  
    style Брокер_Kafka fill:#AFEEEE

```  
